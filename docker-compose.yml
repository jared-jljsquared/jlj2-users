version: '3.8'

services:
  scylla:
    image: scylladb/scylla:latest
    container_name: jlj2-users-scylla
    ports:
      - '9042:9042' # CQL native protocol
      - '10000:10000' # REST API
      - '9160:9160' # Thrift API (legacy)
    volumes:
      - scylla-data:/var/lib/scylla
      - scylla-config:/etc/scylla
    environment:
      - SCYLLA_CLUSTER_NAME=jlj2-users-cluster
      - SCYLLA_DEVELOPER_MODE=1
    command: --smp 1 --memory 1G --overprovisioned 1 --api-address 0.0.0.0
    healthcheck:
      test: ['CMD-SHELL', 'nodetool status | grep -E "^UN\\s+.*" || exit 1']
      interval: 10s
      timeout: 5s
      retries: 30
      start_period: 40s
    networks:
      - jlj2-users-network

volumes:
  scylla-data:
    driver: local
  scylla-config:
    driver: local

networks:
  jlj2-users-network:
    driver: bridge

